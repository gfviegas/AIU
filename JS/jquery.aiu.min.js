!function($,window,document,undefined){function Plugin(e,t){this.element=e,this._input=$("input[type=file]",$(e)),this._options=t,this.settings=$.extend({},defaults,t),this._defaults=defaults,this._name=pluginName,this.init()}function callbackOnload(){console.log("Default Callback On Load function called!")}function callbackSuccess(){console.log("Default Callback Success function called!")}function callbackFails(){console.log("Default Callback Fails function called!")}var pluginName="AIU",defaults={photo_preview:"#photo_preview",photo_error:".photo_error",img_loading_path:"images/ajax-loader.gif",php_path:"photo_controller.php",callback_success:callbackSuccess,callback_fails:callbackFails,callback_onload:callbackOnload};Plugin.prototype={init:function(){var e=this,t=$(this.settings.photo_preview),a=$(this.settings.photo_error),n=t.attr("src"),i=["jpeg","jpg","gif","bmp","png"],s=i.join(", "),o=" An error occured. Check the image extension and size.",r=this.settings.callback_success,l=this.settings.callback_fails,c=this.settings.callback_onload;$(this._input).on("change",function(){c();var d=$(this).val().split(".").pop().toLowerCase(),p=$.inArray(d,i);if(t.attr("src",e.settings.img_loading_path).addClass("loading"),a.hide(),-1==p)return a.show().html(" The image needs to be the in following extensions:"+s),t.attr("src",n).removeClass("loading"),!1;if(e.isAjaxUploadSupported()){var u=new FormData;u.append("Photo",$(this).prop("files")[0]),$.ajax({url:e.settings.php_path,secureuri:!1,fileElementId:"photo_input",dataType:"json",data:u,cache:!1,enctype:"multipart/form-data",type:"POST",processData:!1,contentType:!1,success:function(e){if(e.success)t.attr("src",e.src).removeClass("loading"),r(e.src);else{var i=e.msg||o;a.show().html(i),t.attr("src",n).removeClass("loading"),l()}},error:function(){var e=u.msg||o;return a.show().html(e),t.attr("src",n).removeClass("loading"),l(),!1}})}else{var m=document.createElement("iframe");m.setAttribute("id","upload_iframe_myFile"),m.setAttribute("name","upload_iframe_myFile"),m.setAttribute("width","0"),m.setAttribute("height","0"),m.setAttribute("border","0"),m.setAttribute("src","javascript:false;"),m.style.display="none";var f=document.createElement("form");f.setAttribute("target","upload_iframe_myFile"),f.setAttribute("action",e.settings.php_path),f.setAttribute("method","post"),f.setAttribute("enctype","multipart/form-data"),f.setAttribute("encoding","multipart/form-data"),f.style.display="none";var h=$(this)[0];f.appendChild(h),document.body.appendChild(f),document.body.appendChild(m),iframeIdmyFile=document.getElementById("upload_iframe_myFile");var g=function(){if(iframeIdmyFile.detachEvent?iframeIdmyFile.detachEvent("onload",g):iframeIdmyFile.removeEventListener("load",g,!1),response=e.getIframeContentJSON(iframeIdmyFile),response.success)t.attr("src",response.src).removeClass("loading"),r(response.src);else{var i=response.msg||o;a.show().html(i),t.attr("src",n).removeClass("loading"),l()}};iframeIdmyFile.addEventListener&&iframeIdmyFile.addEventListener("load",g,!0),iframeIdmyFile.attachEvent&&iframeIdmyFile.attachEvent("onload",g),f.submit(),$(photo_form).append(e)}})},isAjaxUploadSupported:function(){var e=document.createElement("input");return e.type="file","multiple"in e&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof(new XMLHttpRequest).upload},getIframeContentJSON:function(iframe){try{var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response,innerHTML=doc.body.innerHTML;"<pre>"==innerHTML.slice(0,5).toLowerCase()&&"</pre>"==innerHTML.slice(-6).toLowerCase()&&(innerHTML=doc.body.firstChild.firstChild.nodeValue),response=eval("("+innerHTML+")")}catch(err){response={success:!1}}return response}},$.fn[pluginName]=function(e){return this.each(function(){$.data(this,"plugin_"+pluginName)||$.data(this,"plugin_"+pluginName,new Plugin(this,e))}),this}}(jQuery,window,document);
