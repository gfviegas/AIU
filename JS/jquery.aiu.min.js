(function($,window,document,undefined){function Plugin(e,t){this.element=e;this._input=$("input[type=file]",$(e));this._options=t;this.settings=$.extend({},defaults,t);this._defaults=defaults;this._name=pluginName;this.init()}function callbackSuccess(){console.log("Default Callback Success function called!")}function callbackFails(){console.log("Default Callback Fails function called!")}var pluginName="AIU",defaults={photo_preview:"#photo_preview",photo_error:".photo_error",img_loading_path:"images/ajax-loader.gif",php_path:"photo_controller.php",callback_success:callbackSuccess,callback_fails:callbackFails};Plugin.prototype={init:function(){var e=this;var t=$(this.settings.photo_preview);var n=$(this.settings.photo_error);var r=t.attr("src");var i=["jpeg","jpg","gif","bmp","png"];var s=i.join(", ");var o=" An error occured. Check the image extension and size.";var u=this.settings.callback_success;var a=this.settings.callback_fails;$(this._input).on("change",function(){var f=$(this).val().split(".").pop().toLowerCase();var l=$.inArray(f,i);t.attr("src",e.settings.img_loading_path).addClass("loading");n.hide();if(l==-1){n.show().html(" The image needs to be the in following extensions:"+s+"");t.attr("src",r).removeClass("loading");return false}if(!e.isAjaxUploadSupported()){var c=document.createElement("iframe");c.setAttribute("id","upload_iframe_myFile");c.setAttribute("name","upload_iframe_myFile");c.setAttribute("width","0");c.setAttribute("height","0");c.setAttribute("border","0");c.setAttribute("src","javascript:false;");c.style.display="none";var h=document.createElement("form");h.setAttribute("target","upload_iframe_myFile");h.setAttribute("action",e.settings.php_path);h.setAttribute("method","post");h.setAttribute("enctype","multipart/form-data");h.setAttribute("encoding","multipart/form-data");h.style.display="none";var p=$(this)[0];h.appendChild(p);document.body.appendChild(h);document.body.appendChild(c);iframeIdmyFile=document.getElementById("upload_iframe_myFile");var d=function(){if(iframeIdmyFile.detachEvent)iframeIdmyFile.detachEvent("onload",d);else iframeIdmyFile.removeEventListener("load",d,false);response=e.getIframeContentJSON(iframeIdmyFile);if(response.success){t.attr("src",response.src).removeClass("loading");u()}else{var i=response.msg||o;n.show().html(i);t.attr("src",r).removeClass("loading");a()}};if(iframeIdmyFile.addEventListener)iframeIdmyFile.addEventListener("load",d,true);if(iframeIdmyFile.attachEvent)iframeIdmyFile.attachEvent("onload",d);h.submit();$(photo_form).append(e)}else{var v=new FormData;v.append("Photo",$(this).prop("files")[0]);$.ajax({url:e.settings.php_path,secureuri:false,fileElementId:"photo_input",dataType:"json",data:v,cache:false,enctype:"multipart/form-data",type:"POST",processData:false,contentType:false,success:function(e){if(e.success){t.attr("src",e.src).removeClass("loading");u()}else{var i=e.msg||o;n.show().html(i);t.attr("src",r).removeClass("loading");a()}},error:function(e,i,s){var u=v.msg||o;n.show().html(u);t.attr("src",r).removeClass("loading");a();return false}})}})},isAjaxUploadSupported:function(){var e=document.createElement("input");e.type="file";return"multiple"in e&&typeof File!="undefined"&&typeof FormData!="undefined"&&typeof (new XMLHttpRequest).upload!="undefined"},getIframeContentJSON:function(iframe){try{var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;var innerHTML=doc.body.innerHTML;if(innerHTML.slice(0,5).toLowerCase()=="<pre>"&&innerHTML.slice(-6).toLowerCase()=="</pre>"){innerHTML=doc.body.firstChild.firstChild.nodeValue}response=eval("("+innerHTML+")")}catch(err){response={success:false}}return response}};$.fn[pluginName]=function(e){this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new Plugin(this,e))}});return this}})(jQuery,window,document)